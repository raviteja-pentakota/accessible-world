<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Welcome - Accessible World</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="./">
    <style>
        /* Existing Styles */
        body {
            font-family: Arial, sans-serif;
            background: #f7f7f7;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .container {
            width: 100%;
            max-width: 800px;
            padding: 25px;
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            text-align: center;
            margin-bottom: 20px;
        }

        button {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: #006699;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 24px;
            cursor: pointer;
        }

        button:hover {
            background: #287ba3;
        }

        label.sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border-width: 0;
        }

        select, .answer-box {
            width: 100%;
            padding: 10px;
            margin-top: 15px;
            font-size: 1rem;
            border-radius: 6px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }

        .answer-box {
            min-height: 50px;
            text-align: left;
            background-color: #e9e9e9;
            padding: 15px;
        }
        .answer-box:focus {
            outline: 2px solid #3399cc;
            outline-offset: 2px;
        }

        /* Footer Styles */
        .footer {
            background: #333;
            color: #fff;
            padding: 10px 20px;
            text-align: center;
            margin-top: auto;
            border-radius: 8px;
            width: 100%;
            max-width: 800px;
        }

        .footer a {
            color: #fff;
            text-decoration: none;
            margin: 0 10px;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* --- NEW MODAL STYLES --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none; /* Hidden by default */
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-overlay.is-visible {
            display: flex;
        }

        .modal {
            background: #ffffff;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            position: relative;
            text-align: left;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            line-height: 1;
            color: #333;
        }

        .modal-close-button:focus {
            outline: 2px solid #006699;
            outline-offset: 2px;
        }

        .modal h2 {
            margin-top: 0;
            color: #006699;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        /* Feedback List Styles (Modal Content) */
        .feedback-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .feedback-list li {
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        .feedback-list li:last-child {
            border-bottom: none;
        }
        .feedback-meta {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
            display: block;
        }
        .feedback-message {
            font-style: italic;
            color: #555;
            line-height: 1.4;
        }
        /* Style for the new Feedback button to keep it consistent */
        #showFeedbackButton {
            background: #3c93d5; /* A slightly different blue for contrast */
        }
        #showFeedbackButton:hover {
            background: #4a9fd6;
        }

    </style>
</head>
<body>
    <div id="main-content" class="container">
        <h1>Welcome to Accessible World!</h1>
        <p>
            In today’s fast-moving world, success demands more than just hard work — it requires the right knowledge and preparation. At Accessible World, we equip you with everything you need: free training in accessibility testing, essential computer skills, and valuable materials like general knowledge, current affairs, and interview preparation resources.
            Plus, with our 3-level referral program, you have the opportunity to grow your network, learn new skills, and earn income at the same time — all within a fully inclusive and supportive environment.
            Don’t wait to unlock your full potential! Register now and log in to start your journey with Accessible World. Learn, explore, and achieve more with us!
        </p>
        <h2>Update: JavaScript Lessons in Web Development Courses!</h2>
        <p>Starting today, we are adding JavaScript topics under our Web Development courses in both Telugu and English. We are uploading the lessons along with videos gradually. As of now, you can explore a few JavaScript topics, and every day we will keep increasing the count. Once all the JavaScript topics are uploaded, we may revise the course price for new users.</p>
        <p>Stay connected and keep learning with us — we’re committed to delivering the best in accessible education!</p>

        <button id="showFeedbackButton" onclick="openModal()">Show Recent User Feedback</button>
        <button onclick="window.location.href='login.html'">Login</button>
        <button onclick="window.location.href='register.html'">Register</button>

        <h2>Question and answers</h2>
        <label for="questionSelect" class="sr-only">Select a question about Accessible World</label>
        <select id="questionSelect">
            <option value="">-- Select a question about Accessible World --</option>
            <option value="about">What is Accessible World?</option>
            <option value="freeCourses">Do you offer free accessibility training?</option>
            <option value="referral">How does the referral program work?</option>
            <option value="earning">Can I earn money through this platform?</option>
            <option value="courseList">What courses are available on the platform?</option>
            <option value="accessibilitySupport">Is the platform accessible for screen reader users?</option>
            <option value="oneTimeFee">Is ₹1000 a recurring fee or one-time payment?</option>
            <option value="whoCanJoin">Who can join Accessible World?</option>
            <option value="paymentMethod">How can I make the ₹1000 payment?</option>
            <option value="withdrawalProcess">How can I withdraw my referral earnings?</option>
        </select>
        <div id="answerBox" class="answer-box" tabindex="-1" aria-live="polite"></div>

        <div id="latestFeedbackContainer" style="display: none;"></div>
    </div>

    <footer class="footer">
        <p>&copy; 2025 Accessible World Tutorials</p>
        <a href="privacy.html" target="_blank">Privacy Policy</a>
        <a href="terms.html" target="_blank">Terms of Service</a>
        <a href="contact.html" target="_blank">Contact Us</a>
    </footer>

    <div id="feedbackModalOverlay" class="modal-overlay">
        <div id="feedbackModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
            <h2 id="modalTitle">Recent User Feedback</h2>

            <ul id="feedbackList" class="feedback-list" role="list">
                <li style="text-align: center;">Loading feedback...</li>
            </ul>

            <button id="closeModalButton" class="modal-close-button" aria-label="Close feedback modal" title="Close">
                &times;
            </button>
        </div>
    </div>
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getFirestore, collection, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        // --- START: Firebase Configuration (Keep this section) ---
        const firebaseConfig = {
            apiKey: "AIzaSyBWtr_ZwK8hfA1We-yq9uUOjw5C6wXhx0k",
            authDomain: "accessibleworld-7f599.firebaseapp.com",
            projectId: "accessibleworld-7f599",
            storageBucket: "accessibleworld-7f599.appspot.com",
            messagingSenderId: "264437218598",
            appId: "1:264437218598:web:cae58c1e578c7b08b815e7",
            measurementId: "G-1QRWXYRZ76"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        // --- END: Firebase Configuration ---

        // --- START: DOM ELEMENTS AND ACCESSIBILITY VARS ---
        const questionSelect = document.getElementById('questionSelect');
        const answerBox = document.getElementById('answerBox');
        const showFeedbackButton = document.getElementById('showFeedbackButton');
        const feedbackModalOverlay = document.getElementById('feedbackModalOverlay');
        const feedbackModal = document.getElementById('feedbackModal');
        const feedbackListContainer = document.getElementById('feedbackList');
        const closeModalButton = document.getElementById('closeModalButton');
        const mainContent = document.getElementById('main-content');
        // We no longer need 'previouslyFocusedElement' in closeModal, as we will explicitly focus the showFeedbackButton.

        // Find all focusable elements within the modal
        const getFocusableElements = () => {
            return feedbackModal.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
        };
        // --- END: DOM ELEMENTS AND ACCESSIBILITY VARS ---

        // --- START: MODAL FUNCTIONS (Updated) ---
        const openModal = () => {
            // 1. Store the currently focused element (not strictly needed since we hard-focus on close, but good practice)
            // previouslyFocusedElement = document.activeElement; 
            
            // 2. Make the main content inert to screen readers
            mainContent.setAttribute('aria-hidden', 'true');
            document.querySelector('.footer').setAttribute('aria-hidden', 'true');

            // 3. Show the modal
            feedbackModalOverlay.classList.add('is-visible');
            document.body.style.overflow = 'hidden';

            // 4. Load the feedback data
            fetchAndDisplayFeedback();

            // 5. Move focus to the close button
            closeModalButton.focus();
        };

        const closeModal = () => {
            // 1. Hide the modal
            feedbackModalOverlay.classList.remove('is-visible');
            document.body.style.overflow = '';

            // 2. Restore main content accessibility
            mainContent.removeAttribute('aria-hidden');
            document.querySelector('.footer').removeAttribute('aria-hidden');

            // 3. Return focus explicitly to the 'Show Recent User Feedback' button (FIX)
            showFeedbackButton.focus(); 
        };

        const trapFocus = (e) => {
            if (feedbackModalOverlay.classList.contains('is-visible')) {
                const focusableElements = getFocusableElements();
                // If there are no other focusable elements (only the close button), the trap is trivial
                if (focusableElements.length <= 1) return; 
                
                const firstFocusableElement = focusableElements[0];
                const lastFocusableElement = focusableElements[focusableElements.length - 1];

                if (e.key === 'Tab') {
                    if (e.shiftKey) { // Shift + Tab
                        if (document.activeElement === firstFocusableElement) {
                            lastFocusableElement.focus();
                            e.preventDefault();
                        }
                    } else { // Tab
                        if (document.activeElement === lastFocusableElement) {
                            firstFocusableElement.focus();
                            e.preventDefault();
                        }
                    }
                } else if (e.key === 'Escape') {
                    closeModal();
                }
            }
        };
        // --- END: MODAL FUNCTIONS ---

        // --- START: MODAL EVENT LISTENERS (New) ---
        showFeedbackButton.addEventListener('click', openModal);
        closeModalButton.addEventListener('click', closeModal);
        feedbackModalOverlay.addEventListener('click', (e) => {
            if (e.target === feedbackModalOverlay) {
                closeModal();
            }
        });
        document.addEventListener('keydown', trapFocus);
        // --- END: MODAL EVENT LISTENERS ---


        // --- START: FAQ LOGIC (Unchanged) ---
        const answers = {
            about: "Accessible World Tutorials is an inclusive learning platform dedicated to empowering individuals, especially the visually impaired. It offers practical training in accessibility testing, HTML, basic computer skills, interview materials, general knowledge, and current affairs. With a focus on accessibility and simplicity, the platform ensures that every learner has equal access to quality education and career-building resources.",
            freeCourses: "No, we do not offer free courses on this platform. To access our valuable training in Web Accessibility, HTML, Basic Computers, Interview Preparation, GK, and Current Affairs, you need to join by paying a one-time fee of ₹1000. This is a lifetime access fee, and there are no additional charges after that.",
            referral: "Our platform offers a 3-level referral program that allows you to earn rewards when you refer others. You will earn income not just from your direct referrals, but also from the people they refer, up to 3 levels deep. Here's how it works:\n\
• Level 1 (Direct Referral): You earn ₹150 for each person who joins through your referral link.\n\
• Level 2: You earn ₹100 when someone joins through your Level 1 referral's link.\n\
• Level 3: You earn ₹50 when someone joins through a Level 2 referral.\n\n\
This way, you can build a growing network and earn passive income while helping others access valuable training.",
            earning: "Yes, you can earn income by referring others to join the platform. As you share your referral link and help others enroll, you’ll receive referral earnings. At the same time, you’ll be learning valuable skills like web accessibility, HTML, and basic computer knowledge, helping you grow both financially and professionally while expanding your network.",
            courseList: "We offer training in Web Accessibility, HTML, Basic Computers, Interview Preparation, and General Knowledge. All courses are designed with accessibility and simplicity in mind.",
            accessibilitySupport: "Yes, Accessible World is fully accessible for screen reader users. We ensure that all our content is usable and inclusive for the visually impaired.",
            oneTimeFee: "The ₹1000 is a one-time lifetime payment. Once you join, you get lifetime access to all available and upcoming courses—no hidden or recurring charges.",
            whoCanJoin: "Anyone who is interested in learning accessibility skills, basic computer knowledge, interview preparation, or general awareness can join. This platform is designed for all learners, including but not limited to visually impaired individuals. Our goal is to provide inclusive and accessible education for everyone.",
            paymentMethod: "You can pay the ₹1000 through UPI, credit/debit cards, or other secure online payment methods integrated into our platform.",
            withdrawalProcess: "You can request a withdrawal once you earn referral income. Simply go to the dashboard, click on 'Show/Hide Referral Details', then select 'Request Withdrawal'. Enter your preferred withdrawal method and the amount, and submit the request. Your request will be sent for admin approval."
        };

        function updateAnswerAndFocus() {
            const selectedValue = questionSelect.value;
            const answerText = answers[selectedValue] || "";
            answerBox.textContent = answerText;

            if (answerText) {
                answerBox.focus();
            }
        }

        let wasArrowKeyUsed = false;

        questionSelect.addEventListener('keydown', function(event) {
            if (event.key === 'ArrowUp' || event.key === 'ArrowDown') {
                wasArrowKeyUsed = true;
            } else if (event.key === 'Enter') {
                event.preventDefault();
                wasArrowKeyUsed = false;
                updateAnswerAndFocus();
            } else {
                wasArrowKeyUsed = false;
            }
        });

        questionSelect.addEventListener('change', function() {
            if (wasArrowKeyUsed) {
                wasArrowKeyUsed = false;
                return;
            }
            updateAnswerAndFocus();
        });

        questionSelect.addEventListener('mousedown', function() {
            wasArrowKeyUsed = false;
        });

        questionSelect.addEventListener('blur', function() {
            updateAnswerAndFocus();
            wasArrowKeyUsed = false;
        });
        // --- END: FAQ LOGIC ---


        // --- START: FEEDBACK DISPLAY LOGIC (Updated to show full name) ---

        const renderFeedbackList = (feedbackList) => {
            feedbackListContainer.innerHTML = ''; // Clear previous list

            if (!feedbackList || feedbackList.length === 0) {
                feedbackListContainer.innerHTML = '<li style="text-align: center;">No feedback submitted yet.</li>';
                return;
            }

            feedbackList.forEach(item => {
                const itemLi = document.createElement('li');
                itemLi.setAttribute('role', 'listitem');

                // FIX: Use the full name instead of just the first name
                const fullName = item.name || 'Anonymous'; 
                
                // Safely format the timestamp
                const date = item.timestamp?.toDate ? item.timestamp.toDate().toLocaleDateString('en-US', {
                    year: 'numeric', month: 'short', day: 'numeric'
                }) : 'N/A';

                // Escape HTML characters to prevent XSS
                const safeText = item.text ? item.text.replace(/</g, "&lt;").replace(/>/g, "&gt;") : 'No message provided.';

                // Display: Full Name, Date, then Message.
                itemLi.innerHTML = `
                    <span class="feedback-meta">
                        ${fullName} on ${date}
                    </span>
                    <p class="feedback-message">${safeText}</p>
                `;
                feedbackListContainer.appendChild(itemLi);
            });
        };

        const fetchAndDisplayFeedback = async () => {
            try {
                feedbackListContainer.innerHTML = '<li style="text-align: center;">Loading recent user feedback...</li>';

                const q = query(collection(db, "feedback"), orderBy("timestamp", "desc"), limit(5));
                const snapshot = await getDocs(q);

                const feedbackList = snapshot.docs.map(doc => doc.data());
                renderFeedbackList(feedbackList);

            } catch (error) {
                console.error("Error fetching feedback:", error);
                feedbackListContainer.innerHTML = '<li style="color: red; text-align: center;">Could not load recent feedback at this time. 😞</li>';
            }
        };
        // --- END: FEEDBACK DISPLAY LOGIC ---

    </script>
</body>
</html>